---
title: "BEE552 Biometry Week 5"
author: "Maria Feiler"
date: "2/23/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(readr)
library(dplyr)
```

## My Learning Journey

*Over the last week, I participated in Biometry in the following ways:*

- I asked / answered **6** questions posed in class.

- I asked **2** questions in Slack.

- I answered **0** questions posed by other students on Slack.

- I came to Heather's office hours: **Yes**

- I came to Jose's office hours: **Yes**

- I met with Heather or Jose separately from office hours: **No**

*Anything not falling into one of the above categories?*  

> **No**

*On a scale of 1 (no knowledge) to 10 (complete expert), how would I rate my* 
*comfort with R programming after this week?* 

> **7**

*Any topics from last week that you are still confused about?*

> **Doing fine for now**

\newpage

## Problem Set

### Part I
*One concern about applying metal tags to penguins is that doing so may increase drag in the water. In a study of the impact of foraging tags on penguin foraging efficiency, the mean length of 344 foraging trips for penguins with a metal tag was 12.70 days with a standard deviation of 3.71 days. For those with an electronic tag (which presumably would not increase drag), the mean foraging trip length was 11.60 days with standard deviation of 4.53 days over 512 trips. Calculate the confidence interval for the difference in foraging trip length and calculate the p-value for the null hypothesis that there is no difference between tag types. (Do not use the R function ‘t.test’. I’m asking you to calculate these yourself.) Do these data provide evidence that mean foraging trips are longer for penguins with a metal tag?*

>An unpaired two sample t-test will be used to determine if there is a difference in foraging lengths of penguins with different tag lengths.
$$
\begin{split}
H_{null}: \overline{x}_{metal} = \overline{x}_{electronic} \\
H_{alt}: \overline{x}_{metal} \neq \overline{x}_{electronic}
\end{split}
\;\;\;\;\;\;
\begin{split}
\overline{x}_{metal} &= 12.70 \\
s_{metal} &= 3.71 \\
n_{metal} &= 344
\end{split}
\;\;\;\;\;\;
\begin{split}
\overline{x}_{electronic} &= 11.60 \\
s_{electronic} &= 4.53 \\
n_{electronic} &= 512
\end{split}
$$

>Assuming the distributions of penguin foraging lengths are normally distributed, then the distributions of foraging lengths are represented by $X_{metal} \sim N\left(\overline{x}_{metal},s_{metal}\right)$ and $X_{metal} \sim N\left(\overline{x}_{electronic},s_{electronic}\right)$ for metal and electronic tags, respectively.

>Assuming that penguin foraging lengths between those with metal versus electronic tag are independent, then...
$$
\overline{X}_{metal} - \overline{X}_{electronic} \sim N(\overline{x}_{metal}-\overline{x}_{electronic}\;, \frac{s^{2}_{metal}}{n_{metal}}+\frac{s^{2}_{electronic}}{n_{electronic}})
$$

> Therefore, the standard error of the difference of means is given by...
$$
SE = \sqrt{\frac{s_{metal}^{2}}{n_{metal}}+\frac{s_{electronic}^{2}}{n_{electronic}}} \; \; ,
$$

> the test statistic is...
$$
T^* = \frac{\overline{x}_{A}-\overline{x}_{B}}{\sqrt{\frac{s_{A}^{2}}{n_{A}}+\frac{s_{B}^{2}}{n_{B}}}} \;\;,
$$

> and the degrees of freedom are calculated using...
$$
dof = \frac{\left(\frac{s_{metal}^{2}}{n_{metal}}+\frac{s_{electronic}^{2}}{n_{electronic}}\right)^{2}}{\frac{\left[\frac{s_{metal}^{2}}{n_{metal}}\right]^2}{n_{metal}-1}+\frac{\left[\frac{s_{electronic}^{2}}{n_{electronic}}\right]^2}{n_{electronic}-1}} \;\;.
$$

> Finally, the 95 percentile confidence interval of the difference in means is given by...
$$
\overline{x}_{metal} + \overline{x}_{electronic} \; \pm \; z\sqrt{\frac{s^{2}_{metal}}{n_{metal}}+\frac{s^{2}_{electronic}}{n_{electronic}}}
$$

>... where z is 1.96, or the z-value corresponding with 95% confidence. 

```{r part 1}
# Penguins with metal tags
metal <- list(12.70, 3.71, 344, 3.71^2)
names(metal) <- c("mean", "sd", "n", "var")

# Penguins with electronic tags
electronic <- list(11.60, 4.53, 512, 4.53^2)
names(electronic) <- c("mean", "sd", "n", "var")

# Create list for hypothesis testing results
penguinHypTest <- vector("list", length = 4)
names(penguinHypTest) <- c("stErr", "t", "dof", "p")

# Calculate standard error of the means
penguinHypTest$stErr <- sqrt(((metal$var)/metal$n)+((electronic$var)/electronic$n))

# Calculate the test statistic
penguinHypTest$t <- (metal$mean-electronic$mean)/penguinHypTest$stErr

# Calculate the degrees of freedom
top <- ((metal$var/metal$n)+(electronic$var/electronic$n))^2
bottom1 <- ((metal$var/metal$n)^2)/(metal$n-1)
bottom2 <- ((electronic$var/electronic$n)^2)/(electronic$n-1)

penguinHypTest$dof <- top/(bottom1 + bottom2)

# Find the p value
penguinHypTest$p <- 2*pt(penguinHypTest$t, 
                         penguinHypTest$dof,
                         lower = FALSE
                         )

# Calculate the 95% confidence interval 
penguinsCI <- vector("list", length = 2)
names(penguinsCI) <- c("LL", "UL")

penguinsCI$LL <- metal$mean-electronic$mean-1.96*penguinHypTest$stErr
penguinsCI$UL <- metal$mean-electronic$mean+1.96*penguinHypTest$stErr
```

```{r part 1 table, echo = FALSE}
temp <- c()
for (i in 1:length(penguinHypTest)){temp[i] <- round(penguinHypTest[[i]], digits = 2)}

kable(rbind(temp),
      caption = "Two-sample t-test results.",
      col.names = c("SE", "T*", "dof", "p"),
      row.names = FALSE
      )

rm(top, bottom1, bottom2, temp)
```

>The 95% confidence interval of the difference of mean foraging length between tag types is (`r paste(round(penguinsCI$LL, digits = 3), round(penguinsCI$UL, digits = 3), sep = ", ")`). The difference in foraging lengths between penguins with different tag types is `r if(penguinHypTest$p <= 0.05) {paste("statistically significant (p = ", round(penguinHypTest$p, digits = 3),").", sep = "")} else{paste("not statistically significant (p = ", round(penguinHypTest$p, digits = 3),").", sep = "")} ` Therefore, the tag type has `r if(penguinHypTest$p <= 0.05) {paste("an appreciable")} else{paste("no appreciable")} ` influence on penguin foraging efficiency. 

\newpage

### Part II
*Download the dataset “diabetes.csv”. This dataset describes a diabetes study by Willems et al. 1997 in which blood glucose (stab.glu) was recorded for males and females (gender) in each of two locations (location).*

```{r diabetes, cache = TRUE}
link <- "https://raw.githubusercontent.com/hlynch/Biometry2022/master/_data/diabetes.csv"
diabetes <- read_csv(link,
                     show_col_types = FALSE
                     )

# Rename "gender" to "sex" for biological accuracy, as "male" and "female" 
# are not genders
diabetes <- rename(diabetes, sex = gender)
```

```{r diabetes table, echo = FALSE, comment = NA, cache = TRUE}
kable(as.data.frame(diabetes[sample(seq(1, length(diabetes$sex)), 10, replace = FALSE),2:4]),
      caption = "A selection of data from Willems et al. 1997.",
      row.names = FALSE,
      col.names = c("Location", "Sex", "Blood Glucose")
      )

rm(link)
```

#### Question 1
*Aggregating across locations, calculate the test statistic for the t-test to test the null hypothesis that males and females do not differ in their average blood glucose levels and compare it to its distribution under the null hypothesis.*

```{r p2q1, comment = NA}
# Get unique location names
uniqueLoc <- unique(diabetes$location)
```
```{r p2q1 uniques, echo = FALSE, comment = NA}
cat(uniqueLoc)
```
```{r p2q1 divide}
# Divide into two datasets based on location
Louisa <- diabetes[which(diabetes$location == uniqueLoc[1]), c("sex", "stab.glu")]

Bucky <- diabetes[which(diabetes$location == uniqueLoc[2]), c("sex", "stab.glu")]
```

>**Louisa**
  
>An unpaired two sample t-test will be used to determine if there is a difference between male and female blood glucose levels in Louisa, England.
$$
\begin{split}
H_{null}: \overline{x}_{male} = \overline{x}_{female}
\end{split}
\;\;\;\;
\begin{split}
H_{alt}: \overline{x}_{male} \neq \overline{x}_{female}
\end{split}
$$

```{r p2q1 louisa, cache = TRUE}
# Males
LMales <- list(mean(Louisa$stab.glu[Louisa$sex == "male"]), 
               sd(Louisa$stab.glu[Louisa$sex == "male"]), 
               sum(Louisa$sex == "male"),
               var(Louisa$stab.glu[Louisa$sex == "male"])
               )
names(LMales) <- c("mean", "sd", "n", "var")

# Females
LFemales <- list(mean(Louisa$stab.glu[Louisa$sex == "female"]), 
                 sd(Louisa$stab.glu[Louisa$sex == "female"]), 
                 sum(Louisa$sex == "female"),
                 var(Louisa$stab.glu[Louisa$sex == "female"])
                 )
names(LFemales) <- c("mean", "sd", "n", "var")

# Create list for hypothesis testing results
LouisaHypTest <- vector("list", length = 4)
names(LouisaHypTest) <- c("stErr", "t", "dof", "p")

# Calculate standard error of the means
LouisaHypTest$stErr <- sqrt(((LMales$var)/LMales$n)+((LFemales$var)/LFemales$n))

# Calculate the test statistic
LouisaHypTest$t <- (LMales$mean-LFemales$mean)/LouisaHypTest$stErr

# Calculate the degrees of freedom
top <- ((LMales$var/LMales$n)+(LFemales$var/LFemales$n))^2
bottom1 <- ((LMales$var/LMales$n)^2)/(LMales$n-1)
bottom2 <- ((LFemales$var/LFemales$n)^2)/(LFemales$n-1)

LouisaHypTest$dof <- top/(bottom1 + bottom2)

# Find the p value
LouisaHypTest$p <- 2*pt(LouisaHypTest$t, 
                         LouisaHypTest$dof,
                         lower = FALSE
                         )

# Calculate the 95% confidence interval 
LouisaCI <- vector("list", length = 2)
names(LouisaCI) <- c("LL", "UL")

LouisaCI$LL <- LMales$mean-LFemales$mean-1.96*LouisaHypTest$stErr
LouisaCI$UL <- LMales$mean-LFemales$mean+1.96*LouisaHypTest$stErr
```
```{r p2q1 Louisa table, echo = FALSE}
temp <- c()
for (i in 1:length(LouisaHypTest)){temp[i] <- round(LouisaHypTest[[i]], digits = 3)}

temp2 <- c()
for (i in 1:length(LouisaCI)){temp2[i] <- round(LouisaCI[[i]], digits = 3)}

kable(cbind(rbind(temp), rbind(temp2)),
      caption = "Louisa male and female blood glucose two-sample t-test results.",
      col.names = c("SE", "T*", "dof", "p", "95CI Lower", "95CI Upper"),
      row.names = FALSE
      )

rm(top, bottom1, bottom2, temp, temp2)
```

\newpage
>**Buckingham**
  
>An unpaired two sample t-test will be used to determine if there is a difference between male and female blood glucose levels in Buckingham, England.
$$
\begin{split}
H_{null}: \overline{x}_{male} = \overline{x}_{female}
\end{split}
\;\;\;\;
\begin{split}
H_{alt}: \overline{x}_{male} \neq \overline{x}_{female}
\end{split}
$$

```{r p2q1 buckingham, cache = TRUE}
# Males
BMales <- list(mean(Bucky$stab.glu[Bucky$sex == "male"]), 
               sd(Bucky$stab.glu[Bucky$sex == "male"]), 
               sum(Bucky$sex == "male"),
               var(Bucky$stab.glu[Bucky$sex == "male"])
               )
names(BMales) <- c("mean", "sd", "n", "var")

# Females
BFemales <- list(mean(Bucky$stab.glu[Bucky$sex == "female"]), 
                 sd(Bucky$stab.glu[Bucky$sex == "female"]), 
                 sum(Bucky$sex == "female"),
                 var(Bucky$stab.glu[Bucky$sex == "female"])
                 )
names(BFemales) <- c("mean", "sd", "n", "var")

# Create list for hypothesis testing results
BuckyHypTest <- vector("list", length = 4)
names(BuckyHypTest) <- c("stErr", "t", "dof", "p")

# Calculate standard error of the means
BuckyHypTest$stErr <- sqrt(((BMales$var)/BMales$n)+((BFemales$var)/BFemales$n))

# Calculate the test statistic
BuckyHypTest$t <- (BMales$mean-BFemales$mean)/BuckyHypTest$stErr

# Calculate the degrees of freedom
top <- ((BMales$var/BMales$n)+(BFemales$var/BFemales$n))^2
bottom1 <- ((BMales$var/BMales$n)^2)/(BMales$n-1)
bottom2 <- ((BFemales$var/BFemales$n)^2)/(BFemales$n-1)

BuckyHypTest$dof <- top/(bottom1 + bottom2)

# Find the p value
BuckyHypTest$p <- 2*pt(BuckyHypTest$t, 
                       BuckyHypTest$dof,
                       lower = FALSE
                       )

# Calculate the 95% confidence interval 
BuckyCI <- vector("list", length = 2)
names(BuckyCI) <- c("LL", "UL")

BuckyCI$LL <- BMales$mean-BFemales$mean-1.96*BuckyHypTest$stErr
BuckyCI$UL <- BMales$mean-BFemales$mean+1.96*BuckyHypTest$stErr
```
```{r p2q1 Bucky table, echo = FALSE}
temp <- c()
for (i in 1:length(BuckyHypTest)){temp[i] <- round(BuckyHypTest[[i]], digits = 3)}

temp2 <- c()
for (i in 1:length(BuckyCI)){temp2[i] <- round(BuckyCI[[i]], digits = 3)}

kable(cbind(rbind(temp), rbind(temp2)),
      caption = "Buckingham male and female blood glucose two-sample t-test results.",
      col.names = c("SE", "T*", "dof", "p", "95CI Lower", "95CI Upper"),
      row.names = FALSE
      )

rm(top, bottom1, bottom2, temp, temp2)
```

#### Question 2
*Compare your results with the R function “t.test”. (Copy and paste results below.) Explain what every single number reported in the output of t.test means.*

```{r p2q2}
ttestLouisa <- t.test(Louisa$stab.glu[Louisa$sex == "male"], 
                      Louisa$stab.glu[Louisa$sex == "female"]
                      )

ttestBucky <- t.test(Bucky$stab.glu[Louisa$sex == "male"], 
                     Bucky$stab.glu[Louisa$sex == "female"]
                     )
```

```{r p2q2 ttest results, echo = FALSE, comment = NA}
ttestLouisa$data.name <- "Louisa Males and Females"
names(ttestLouisa$estimate) <- c("Mean Male Glucose", "Mean Female Glucose")

ttestBucky$data.name <- "Buckingham Males and Females"
names(ttestBucky$estimate) <- c("Mean Male Glucose", "Mean Female Glucose")

ttestLouisa
ttestBucky
```

>The p-values produced by the t.test() calculations are the same as the p-values obtained from manual test statistic calculations.

#### Question 3
*Interpret your results in words as you would in the results section of a manuscript (1-2 sentences)*

An unpaired two sample t-test was used to test if there was a significant difference between the blood glucose levels of Louisa males (`r paste(round(LMales$mean, digits = 2))`$\pm$ `r paste(round(LMales$sd, digits = 2))`) and females (`r paste(round(LFemales$mean, digits = 2))`$\pm$ `r paste(round(LFemales$sd, digits = 2))` ). At the critical value of $\alpha_{C} = 0.05$, the difference between Louisa male and female blood glucose levels is `r if(LouisaHypTest$p <= 0.05) {paste("statistically significant (p = ", round(LouisaHypTest$p, digits = 3), ", t* = ", round(LouisaHypTest$t, digits = 3), ", df = ", round(LouisaHypTest$dof, digits = 2), ")", sep = "")} else {paste("not statistically significant (p = ", round(LouisaHypTest$p, digits = 3), ", t* = ", round(LouisaHypTest$t, digits = 3), ", df = ", round(LouisaHypTest$dof, digits = 2), ")", sep = "")} `, and the null hypothesis is `r ifelse(LouisaHypTest$p <= 0.05, paste("rejected."), paste("not rejected.")) ` The 95^th^ percentile confidence interval for the difference in mean blood glucose levels between Louisa males and females is (`r paste(round(LouisaCI$LL, digits = 2), ", ", round(LouisaCI$UL, digits = 2), sep = "")`), suggesting that the Louisa females had `r ifelse(LMales$mean - LFemales$mean > 0, paste("significantly lower"), paste("significantly higher")) ` blood glucose levels then their male counterparts. 

An unpaired two sample t-test was used to test if there was a significant difference between the blood glucose levels of Buckingham (`r paste(round(BMales$mean, digits = 2))`$\pm$ `r paste(round(BMales$sd, digits = 2))`) and females (`r paste(round(BFemales$mean, digits = 2))`$\pm$ `r paste(round(BFemales$sd, digits = 2))` ). At the critical value of $\alpha_{C} = 0.05$, the difference between Buckingham male and female blood glucose levels is `r if(BuckyHypTest$p <= 0.05) {paste("statistically significant (p = ", round(BuckyHypTest$p, digits = 3), ", t* = ", round(BuckyHypTest$t, digits = 3), ", df = ", round(BuckyHypTest$dof, digits = 2), ")", sep = "")} else {paste("not statistically significant (p = ", round(BuckyHypTest$p, digits = 3), ", t* = ", round(BuckyHypTest$t, digits = 3), ", df = ", round(BuckyHypTest$dof, digits = 2), ")", sep = "")} `, and the null hypothesis is `r ifelse(BuckyHypTest$p <= 0.05, paste("rejected."), paste("not rejected.")) ` The 95^th^ percentile confidence interval for the difference in mean blood glucose levels between Buckingham males and females is (`r paste(round(BuckyCI$LL, digits = 2), ", ", round(BuckyCI$UL, digits = 2), sep = "")`), suggesting that the Buckingham females had `r ifelse(LMales$mean - LFemales$mean > 0, paste("significantly lower"), paste("significantly higher")) ` blood glucose levels then their male counterparts. 